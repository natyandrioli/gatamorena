$(function(){function l(a){return a.children(".product-list-item-inner").children(".wrapper-product-combination").find(".product-combination-list")}function u(a,b){var c=a.closest(".product-list-item").find(".wrapper-btn-product"),d=a.closest(".product-list-item"),e=a.closest(".product-list-item-inner").find(".product-image");ProductModel.id=d.data("id");d=ProductModel.getChecked(l(d));a.find(".product-comb-attribute").prop("checked")&&ProductModel.find(d,function(){},function(b){f(a,0,e);var d=e.children("a");
if(null!==b.id){if(n(a,b),p(a,b.valor_venda_unitario),q(a,b.parcelas,b.valor_parcelado),r(a,b.desconto_avista,b.valor_avista),t(a,b.combinacoes),g(a,null,0),h(c,a,0,b),$(b.img).css("opacity",1),!0!==b.disponivel&&(f(a,1,e),g(a,b,1),h(c,a,1,b),$(b.img).css("opacity",.5)),$(b.img).fadeIn(500),d.children("img").remove(),d.append(b.img),0!=b.imgsec){d.children("img:first-child").addClass("image-main");var k=document.createElement("img");k.src=base_url_image+"/sku/thumb_"+b.imgsec;k.style.cssText="display:none;";
k.setAttribute("class","image-over");d.append(k)}}else f(a,1,e),g(a,b,1),h(c,a,1,b)})}function w(a,b){var c=a.closest(".product-list-item").find(".wrapper-btn-product"),d=a.closest(".product-list-item"),e=$(d).find(".product-image");e.children("a").children("img");ProductModel.id=d.data("id");var m=ProductModel.getChecked(l(d));a.find(".product-comb-attribute").prop("checked")&&ProductModel.find(m,null,function(b){f(a,0,e);null!==b.id?(n(a,b),p(a,b.valor_venda_unitario),q(a,b.parcelas,b.valor_parcelado),
r(a,b.desconto_avista,b.valor_avista),t(a,b.combinacoes),f(a,0,e),g(a,null,0),h(c,a,0,b),!0!==b.disponivel&&(f(a,1,e),g(a,b,1),h(c,a,1,b),$(b.img).css("opacity",.5))):(f(a,1,e),g(a,b,1),h(c,a,1,b),$(d).addClass("comb-unavailable"))})}function n(a,b){var c=a.closest(".product-list-item-inner").find(".product-old-price"),d=a.closest(".product-list-item-inner").find(".label-promo");b.promocao&&null!==b.valor_original?(c.show(),d.html(b.percentual_promocao),d.show(),c.removeClass("product-price"),c.children("span:nth-child(1)").html("de "),
c.children("span:nth-child(2)").html(accounting.formatMoney(b.valor_original)),c.children("span:nth-child(2)").attr("class","product-strikethrough-price")):(c.find("span").html(""),d.hide(),c.hide())}function p(a,b){var c=a.closest(".product-list-item-inner").find(".product-sell-price");c.children("span:nth-child(1)").html("Por ");c.children("span:nth-child(2)").html("");c.children("span:nth-child(2)").html(accounting.formatMoney(b));c.children("span:nth-child(2)").attr("class","product-big-price")}
function q(a,b,c){a=a.closest(".product-list-item-inner").find(".product-parcelled-price");a.children(".product-number-parcels").html("");a.children(".product-number-parcels").html(b+"x");a.children(".product-big-price").html("");a.children(".product-big-price").html(accounting.formatMoney(c))}function r(a,b,c){0<b&&(a=a.closest(".product-list-item-inner").find(".product-cash-price"),a.children(".product-big-price").html(""),a.children(".product-big-price").html(accounting.formatMoney(c)),a.children(".product-price-off").html(""),
a.children(".product-price-off").html(b+"%"))}function t(a,b){var c=$(a).closest(".wrapper-product-combination");c.html("");var d="";$.each(b,function(a,b){d+='<span class="product-combination-title">'+b.label+'</span><ul class="product-combination-list">';$.each(b.CombinacaoAtributo,function(a,c){var e=1==c.disponivel?"":" product-combination-unavailable",v=1==c.selecionado?" product-combination-active":"",k=1==b.mostra_vitrine?" active-combination":"",m=1==c.selecionado?' checked="checked" ':"";
if("imagem"==c.tipo_capa)var f='<div class="combination-image"><img src="'+base_url_image+"/combinacao_atributo/thumb_"+c.name+'" alt=""></div>';else"cor"==c.tipo_capa?(f='<div style="background-color:#'+c.cor_primaria.replace("#","")+'" >',null!=c.cor_secundaria&&""!=c.cor_secundaria&&(f+='<span style="border-color:#'+c.cor_secundaria.replace("#","")+'"></span>'),f+="</div>"):f="<div>"+c.nome+"</div>";d+='<li class="product-combination-item'+e+v+" "+b.classes_adicionais+'"><label for="CatalogoCombinacaoAtributoId'+
b.produto_id+b.id+c.id+'" title="'+c.nome+'">'+f+"</label>"+(1==c.disponivel?"":'<span class="label-product-combination-unavailable">x</span>')+'<input type="hidden" name="data[CatalogoCombinacaoAtributo][id]['+b.produto_id+"]["+b.id+"]["+c.id+']" id="CatalogoCombinacaoAtributoId'+b.produto_id+b.id+c.id+'_" value="0"><input type="checkbox" name="data[CatalogoCombinacaoAtributo][id]['+b.produto_id+"]["+b.id+"]["+c.id+']" value="'+c.id+'"'+m+'class="comb-'+b.id+" product-comb-attribute"+k+" prod-"+
b.produto_id+'" data-order="'+b.ordem+'" id="CatalogoCombinacaoAtributoId'+b.produto_id+b.id+c.id+'"></li>'});d+="</ul>"});c.html(d);c.removeClass("product-combination-loading")}function h(a,b,c,d){if(1==c)var e='<div class="wrapper-btn-buy"><a href="javascript:;" class="btn btn-tell-me"><span class="icon-buy icon-tell-me btn-icon"></span><span class="btn-text">'+d.msg_aviseme+"</span></a></div>";else 0==c&&(e='<div class="wrapper-btn-buy"><a href="javascript:;" class="btn btn-buy"><span class="icon-buy btn-icon"></span><span class="btn-text">'+
d.label_comprar+"</span></a></div>");a.html(e)}function g(a,b,c){1==c?("0"==b.exibe_preco_aviseme&&(c=$(a).closest(".product-list-item-inner").children(".product-info"),c.find("p").hide(),c.find(".product-name").show()),$(".modal-product-info").children(".product-price").html(b.sku),$("#tellme-sku").val(b.id),a.closest(".product-list-item").attr("data-sku",$("#tellme-sku").val())):0==c&&(a=$(a).closest(".product-list-item-inner").children(".product-info"),a.find("p").show(),a.find(".product-sku").hide())}
function f(a,b,c){a='<a class="label-product label-unavailable" href="'+c.children("a").attr("href")+'">Produto Indispon\u00edvel</a>';1==b?(c.find(".label-unavailable").remove(),$(c).append(a)):0==b&&c.find(".label-unavailable").remove()}function x(a){var b=[],c="";a.closest(".product-list-item").find(".product-combination-list").each(function(){c=$(this).prev().text();b[b.length]=c});return b}ProductModel.init();$(document).on("click",".product-combination-item",function(a){a.preventDefault();$(this).find(".product-comb-attribute").prop("checked",
!0);a=$(this).find(".product-comb-attribute").val();this.className.split(" ").pop();this.className.split(" ").shift();$(this).closest(".product-combination-list").find('.product-comb-attribute[value="'+a+'"]').prop("checked",!0).parent().addClass("product-combination-active");$(this).closest(".product-combination-list").find('.product-comb-attribute[value!="'+a+'"]').prop("checked",!1).parent().removeClass("product-combination-active");$(this).closest(".wrapper-product-combination").addClass("product-combination-loading");
$(this).find(".product-comb-attribute").hasClass("active-combination")?u($(this)):w($(this))});$(document).on("click",".btn-disabled",function(){return!1});$(document).on("click",".btn-buy",function(a){var b=$(this),c=b.children(".btn-text"),d=b.closest(".product-list-item");ProductModel.id=d.data("id");var e=l(d),f=[];e=ProductModel.getChecked(e);l(d).size()==e.length?(a.preventDefault(),b.hasClass("btn-disabled")||(b.addClass("btn-disabled"),c.addClass("loading-button"),$(".loading-page").show(),
ProductModel.cartCreateProduct(e,f,function(){},function(a){if(a.alerta_quantidade)1==a.alerta_quantidade?($(".loading-page").hide(),c.removeClass("loading-button"),$.message.show("error",{vars:{title:"Produto indispon\u00edvel"},idleTime:4E3})):($(".loading-page").hide(),c.removeClass("loading-button"),$.message.show("error",{vars:{title:a.alerta_quantidade.replace(".",",")},idleTime:4E3}));else{$(".shopping-cart-total-price");var e=d.children().children(".product-image").children("a").children("img");
if("3"==a.acao_comprar||"4"==a.acao_comprar){var f=base_url+"carrinho";$(location).attr("href",f)}else $(".loading-page").hide(),c.removeClass("loading-button"),$.message.show(a.continuar_comprando);App.refreshCartIcon(a);App.addProductIcon(a,e)}setTimeout(function(){b.removeClass("btn-disabled")},1100)}))):(a=x(b),$.message.show("error",{vars:{title:"Voc\u00ea precisa selecionar as combina\u00e7\u00f5es:<br/>"+a.join(", ")},idleTime:4E3}))});$(document).on("click",".btn-tell-me",function(a){a=$(this);
a.children(".btn-text");var b=a.closest(".product-list-item");ProductModel.id=b.data("id");a=l(b);a=ProductModel.getChecked(a);b=l(b).size();var c=$(this).closest(".product-list-item").data("id"),d=$(this).closest(".product-list-item-inner").find(".product-image").children("a").children("img").attr("src"),e=$(this).closest(".product-list-item-inner").find(".product-name").children("a").html(),f=$(this).closest(".product-list-item-inner").find(".product-sku").html(),g=$(".modal-product-image").children("img"),
k=$(".modal-product-info").children(".product-name"),h=$(".modal-product-info").children(".product-price");g.attr("src",d);k.html(e);h.html(f);$("#tellme-produto-id").val(c);b==a.length?$.modal.show(null,"modal-tell-me"):$.message.show("error",{vars:{title:"Voc\u00ea precisa selecionar todas as combina\u00e7\u00f5es."},idleTime:4E3})});$(document).on("click","#tellme-btn",function(a){$("#form-tellme").submit()});$("#form-tellme").validate({submitHandler:function(){var a=$("#g-recaptcha-response").val();
0<a.length?($("#tellme-btn").find(".btn-text").addClass("loading-button"),$.ajax({url:base_url+"produto/aviseme/add2",data:{nome:$("#tellme-nome").val(),email:$("#tellme-email").val(),produto_id:$("#tellme-produto-id").val(),produto_estoque_id:$("#tellme-sku").val(),recaptcha_response:a},dataType:"json",type:"POST",success:function(a){$("#tellme-btn").find(".btn-text").removeClass("loading-button");-1==a.id?$.message.show("error",{vars:{title:a.mensagem},idleTime:3500}):($(".modal-mask").hide(),$(".modal").hide(),
$.message.show("success",{vars:{title:"Aviso cadastrado com sucesso!",idleTime:3500}}))}})):($("#g-recaptcha-response-error").remove(),$(".modal-captcha").append('<label id="g-recaptcha-response-error" class="error" for="g-recaptcha-response">Voc\u00ea precisa completar o Captcha de seguran\u00e7a.</label>'))}});$(document).on("click",".btn-budget",function(){var a=$("#form-budget"),b=$(this).closest(".product-list-item-inner"),c=$(this).closest(".product-list-item").data("id"),d=$(this).closest(".product-list-item").data("sku"),
e=$(".modal-product-image").children("img"),f=$(".modal-product-info").children(".product-name"),g=b.find(".product-image").children("a").children("img").attr("src");b=b.find(".product-name").children("a").html();a.find("#CotacaoProdutoId").val(c);a.find("#CotacaoEstoqueId").val(d);e.attr("src",g);f.html(b);$("#g-recaptcha-response-error").remove();0<$("#g-recaptcha-response").val().length&&grecaptcha.reset();$.modal.show(null,"modal-budget")});$(document).on("click","#budget-btn",function(){if($("#form-budget").valid()){var a=
$("#g-recaptcha-response").val();if(0<a.length){var b={},c=WsRouter.generateRoute(null,"produto","cotacaoProduto",null);b={clienteNome:$("#CotacaoNome").val(),clienteEmail:$("#CotacaoEmail").val(),clienteTelefone:$("#CotacaoTelefone").val(),clienteObservacao:$("#CotacaoObservacao").val(),clienteLogradouro:$("#CotacaoLogradouro").val(),clienteNumero:$("#CotacaoNumero").val(),clienteComplemento:$("#CotacaoComplemento").val(),clienteBairro:$("#CotacaoBairro").val(),clienteCidade:$("#CotacaoCidade").val(),
clienteEstado:$("#CotacaoEstado").val(),clienteCep:$("#CotacaoCep").val(),produtoId:$("#CotacaoProdutoId").val(),produtoEstoqueId:$("#CotacaoEstoqueId").val(),quantidade:$("#CotacaoQuantidade").val(),recaptcha_response:a};WsDispatcher.postRequest(c,{VendaCotacao:JSON.stringify(b)},null,function(a){1==a.status?($.modal.hide("fadeInUp","modal-budget"),$.message.show("success",{vars:{title:a.message},idleTime:4E3})):$.message.show("error",{vars:{title:a.message},idleTime:4E3})})}else $("#g-recaptcha-response-error").remove(),
$("#div-captcha-budget").append('<label id="g-recaptcha-response-error" class="error" for="g-recaptcha-response">Voc\u00ea precisa completar o Captcha de seguran\u00e7a.</label>')}})});